import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInAnonymously, 
  signInWithCustomToken, 
  onAuthStateChanged 
} from 'firebase/auth';
import { 
  getFirestore, 
  collection, 
  addDoc, 
  onSnapshot, 
  doc, 
  updateDoc, 
  deleteDoc, 
  serverTimestamp,
  query, 
  orderBy 
} from 'firebase/firestore';
import { 
  PiggyBank, 
  Plus, 
  Minus, 
  Trash2, 
  History, 
  Trophy, 
  Moon, 
  Sun, 
  TrendingUp, 
  Target,
  Hammer,
  X,
  Check,
  Wallet,
  ArrowLeft
} from 'lucide-react';

// --- Confetti Utility (Simplified) ---
const fireConfetti = () => {
  const count = 200;
  const defaults = { origin: { y: 0.7 } };

  function fire(particleRatio, opts) {
    if (window.confetti) {
        window.confetti({ ...defaults, ...opts, particleCount: Math.floor(count * particleRatio) });
    }
  }

  if (window.confetti) {
      fire(0.25, { spread: 26, startVelocity: 55 });
      fire(0.2, { spread: 60 });
      fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
      fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
      fire(0.1, { spread: 120, startVelocity: 45 });
  }
};

// --- Firebase Initialization ---
const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = window.__app_id || 'default-app-id';

// --- Components ---

const MotivationalMessage = ({ type }) => {
  const messages = {
    deposit: [
      "√ìtimo trabalho! üöÄ",
      "Cada centavo conta! üí∞",
      "O futuro agradece! üå±",
      "Mais um passo rumo ao sonho! ‚ú®",
      "Poupar √© poder! üí™"
    ],
    broken: [
      "Aproveite sua conquista! üéâ",
      "Recome√ßar faz parte! üîÑ",
      "Miss√£o cumprida! üèÜ"
    ],
    create: [
      "Novo objetivo, novo foco! üéØ",
      "Vamos encher esse cofrinho! üê∑"
    ]
  };
  
  const list = messages[type] || messages.deposit;
  const randomMsg = list[Math.floor(Math.random() * list.length)];
  
  return (
    <div className="animate-fade-in-up text-center py-2 px-4 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-full text-sm font-medium shadow-sm mt-4 mx-4">
      {randomMsg}
    </div>
  );
};

const CoinAnimation = ({ onComplete }) => {
  useEffect(() => {
    const timer = setTimeout(onComplete, 1000);
    return () => clearTimeout(timer);
  }, [onComplete]);

  return (
    <div className="fixed inset-0 pointer-events-none flex items-center justify-center z-50 overflow-hidden">
      <div className="animate-drop-coin text-yellow-400 text-7xl drop-shadow-2xl filter drop-shadow-lg">
        ü™ô
      </div>
    </div>
  );
};

export default function App() {
  const [user, setUser] = useState(null);
  const [piggies, setPiggies] = useState([]);
  const [loading, setLoading] = useState(true);
  const [darkMode, setDarkMode] = useState(false);
  const [view, setView] = useState('dashboard'); // 'dashboard', 'create', 'details'
  const [selectedPiggyId, setSelectedPiggyId] = useState(null);
  
  const selectedPiggy = piggies.find(p => p.id === selectedPiggyId);
  
  // Form States
  const [newPiggyName, setNewPiggyName] = useState('');
  const [newPiggyGoal, setNewPiggyGoal] = useState('');
  const [depositAmount, setDepositAmount] = useState('');
  
  // UX States
  const [showConfetti, setShowConfetti] = useState(false);
  const [showCoinAnim, setShowCoinAnim] = useState(false);
  const [message, setMessage] = useState(null);
  const [showBreakModal, setShowBreakModal] = useState(false);

  // --- Auth & Data Loading ---
  useEffect(() => {
    const initAuth = async () => {
      if (window.__initial_auth_token) {
        await signInWithCustomToken(auth, window.__initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, setUser);
    
    // Load confetti script
    const script = document.createElement('script');
    script.src = "https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";
    script.async = true;
    document.body.appendChild(script);

    return () => {
      unsubscribe();
      document.body.removeChild(script);
    };
  }, []);

  useEffect(() => {
    if (!user) return;
    
    const collectionRef = collection(db, 'artifacts', appId, 'users', user.uid, 'piggybanks');
    const unsubscribe = onSnapshot(collectionRef, (snapshot) => {
      const loadedPiggies = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      loadedPiggies.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      setPiggies(loadedPiggies);
      setLoading(false);
    }, (error) => {
      console.error("Error fetching piggies:", error);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [user]);

  // --- Actions ---

  const createPiggy = async (e) => {
    e.preventDefault();
    if (!newPiggyName || !newPiggyGoal) return;

    try {
      await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'piggybanks'), {
        name: newPiggyName,
        goal: parseFloat(newPiggyGoal),
        current: 0,
        createdAt: serverTimestamp(),
        color: ['bg-pink-500', 'bg-blue-500', 'bg-purple-500', 'bg-teal-500', 'bg-orange-500'][Math.floor(Math.random() * 5)],
        history: []
      });
      setNewPiggyName('');
      setNewPiggyGoal('');
      setView('dashboard');
      triggerMessage('create');
    } catch (err) {
      console.error(err);
    }
  };

  const addMoney = async (amount) => {
    if (!selectedPiggy) return;
    setShowCoinAnim(true);
    
    const val = parseFloat(amount);
    const newTotal = selectedPiggy.current + val;
    const newEntry = {
      date: new Date().toISOString(),
      amount: val,
      type: 'deposit'
    };

    try {
      const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'piggybanks', selectedPiggy.id);
      await updateDoc(docRef, {
        current: newTotal,
        history: [newEntry, ...(selectedPiggy.history || [])]
      });
      
      triggerMessage('deposit');

      if (newTotal >= selectedPiggy.goal && selectedPiggy.current < selectedPiggy.goal) {
        fireConfetti();
      }
    } catch (err) {
      console.error(err);
    }
  };

  const breakPiggy = async () => {
    if (!selectedPiggy) return;
    fireConfetti();
    triggerMessage('broken');
    
    try {
      const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'piggybanks', selectedPiggy.id);
      await updateDoc(docRef, {
        current: 0,
        history: [{
          date: new Date().toISOString(),
          amount: -selectedPiggy.current,
          type: 'withdraw'
        }, ...(selectedPiggy.history || [])]
      });
      setShowBreakModal(false);
    } catch (err) {
      console.error(err);
    }
  };

  const deletePiggy = async () => {
     if (!selectedPiggy) return;
     try {
       await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'piggybanks', selectedPiggy.id));
       setSelectedPiggyId(null);
       setView('dashboard');
     } catch(err) {
       console.error(err);
     }
  };

  const triggerMessage = (type) => {
    setMessage(type);
    setTimeout(() => setMessage(null), 3000);
  };

  const formatCurrency = (val) => {
    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
  };

  // --- Views ---

  if (loading) {
    return (
      <div className="min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center">
        <div className="animate-bounce text-5xl">üê∑</div>
      </div>
    );
  }

  return (
    <div className={`min-h-screen w-full transition-colors duration-300 ${darkMode ? 'dark bg-slate-900 text-white' : 'bg-slate-50 text-slate-800'}`}>
      
      {/* Header - Sticky and Native Feel */}
      <header className="px-4 py-3 flex justify-between items-center sticky top-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md z-30 border-b border-slate-200 dark:border-slate-800 shadow-sm safe-top">
        <div className="flex items-center gap-2 active:opacity-70 transition-opacity cursor-pointer" onClick={() => { setView('dashboard'); setSelectedPiggyId(null); }}>
          <div className="bg-pink-500 p-2 rounded-xl text-white shadow-pink-500/20 shadow-lg">
            <PiggyBank size={24} strokeWidth={2.5} />
          </div>
          <h1 className="font-bold text-xl tracking-tight leading-none">Cofrinho<span className="text-pink-500">App</span></h1>
        </div>
        <button 
          onClick={() => setDarkMode(!darkMode)}
          className="p-3 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 active:bg-slate-200 transition-colors touch-manipulation"
        >
          {darkMode ? <Sun size={22} /> : <Moon size={22} />}
        </button>
      </header>

      {/* Main Container - Full Width on Mobile, Centered on Desktop */}
      <main className="w-full max-w-md mx-auto pb-24 relative min-h-[calc(100vh-80px)]">
        
        {/* Floating Messages */}
        {message && <MotivationalMessage type={message} />}

        {/* Dashboard View */}
        {view === 'dashboard' && (
          <div className="p-4 space-y-6 animate-fade-in">
            {/* Summary Card */}
            <div className="bg-gradient-to-br from-indigo-500 via-purple-500 to-purple-700 rounded-3xl p-6 text-white shadow-xl shadow-purple-500/20 transform transition-transform active:scale-[0.98]">
              <p className="opacity-90 text-sm font-medium mb-1">Total Economizado</p>
              <h2 className="text-4xl font-extrabold tracking-tight">
                {formatCurrency(piggies.reduce((acc, curr) => acc + (curr.current || 0), 0))}
              </h2>
              <div className="mt-4 flex gap-2">
                <div className="bg-white/20 backdrop-blur-md px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 border border-white/10">
                  <Trophy size={14} className="text-yellow-300" /> 
                  {piggies.filter(p => p.current >= p.goal).length} Conquistados
                </div>
              </div>
            </div>

            {/* Piggy List */}
            <div>
              <div className="flex justify-between items-center mb-4 px-1">
                <h3 className="font-bold text-lg text-slate-700 dark:text-slate-200">Meus Objetivos</h3>
                <button 
                  onClick={() => setView('create')}
                  className="bg-pink-50 dark:bg-pink-900/30 text-pink-500 p-2.5 rounded-full active:bg-pink-100 transition-colors"
                >
                  <Plus size={24} strokeWidth={2.5} />
                </button>
              </div>

              {piggies.length === 0 ? (
                <div className="text-center py-12 px-4 opacity-60 bg-white dark:bg-slate-800/50 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-700 mx-1">
                  <PiggyBank size={56} className="mx-auto mb-3 text-slate-300 dark:text-slate-600" />
                  <p className="text-slate-500 mb-4">Voc√™ ainda n√£o tem cofrinhos.</p>
                  <button onClick={() => setView('create')} className="bg-pink-500 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-pink-500/30 active:scale-95 transition-transform">
                    Criar meu primeiro!
                  </button>
                </div>
              ) : (
                <div className="flex flex-col gap-4">
                  {piggies.map(piggy => {
                    const percent = Math.min(100, (piggy.current / piggy.goal) * 100);
                    return (
                      <div 
                        key={piggy.id}
                        onClick={() => { setSelectedPiggyId(piggy.id); setView('details'); }}
                        className="bg-white dark:bg-slate-800 p-5 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700/50 cursor-pointer active:scale-[0.98] transition-all touch-manipulation"
                      >
                        <div className="flex justify-between items-start mb-3">
                          <div className="flex items-center gap-3.5">
                            <div className={`w-12 h-12 rounded-2xl ${piggy.color || 'bg-pink-500'} flex items-center justify-center text-white shadow-md transform -rotate-3`}>
                              <PiggyBank size={24} />
                            </div>
                            <div>
                              <h4 className="font-bold text-lg leading-tight">{piggy.name}</h4>
                              <p className="text-xs font-medium text-slate-400 dark:text-slate-500 mt-0.5">Meta: {formatCurrency(piggy.goal)}</p>
                            </div>
                          </div>
                          <span className="font-bold text-lg text-slate-700 dark:text-slate-200 bg-slate-50 dark:bg-slate-700/50 px-3 py-1 rounded-lg">
                            {formatCurrency(piggy.current)}
                          </span>
                        </div>
                        
                        <div className="relative h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
                          <div 
                            className={`absolute top-0 left-0 h-full ${percent >= 100 ? 'bg-green-500' : 'bg-pink-500'} transition-all duration-1000 ease-out`}
                            style={{ width: `${percent}%` }}
                          />
                        </div>
                        <div className="flex justify-between items-center mt-2">
                           <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Progresso</span>
                           <span className={`text-xs font-bold ${percent >= 100 ? 'text-green-500' : 'text-pink-500'}`}>{Math.round(percent)}%</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        )}

        {/* Create View */}
        {view === 'create' && (
          <div className="p-4 animate-fade-in">
             <div className="flex items-center mb-8">
              <button onClick={() => setView('dashboard')} className="mr-4 p-3 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full active:scale-90 transition-transform">
                <ArrowLeft size={24} />
              </button>
              <h2 className="text-2xl font-bold">Novo Cofrinho</h2>
            </div>
            
            <form onSubmit={createPiggy} className="space-y-6">
              <div>
                <label className="block text-sm font-bold mb-2 text-slate-500 uppercase tracking-wide px-1">Nome do Objetivo</label>
                <input 
                  type="text" 
                  value={newPiggyName}
                  onChange={e => setNewPiggyName(e.target.value)}
                  placeholder="Ex: Bicicleta Nova"
                  className="w-full p-4 rounded-2xl bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 focus:border-pink-500 focus:ring-4 focus:ring-pink-500/10 outline-none text-xl font-medium transition-all"
                  autoFocus
                />
              </div>
              
              <div>
                <label className="block text-sm font-bold mb-2 text-slate-500 uppercase tracking-wide px-1">Valor da Meta (R$)</label>
                <input 
                  type="number" 
                  inputMode="decimal"
                  pattern="[0-9]*"
                  value={newPiggyGoal}
                  onChange={e => setNewPiggyGoal(e.target.value)}
                  placeholder="0,00"
                  className="w-full p-4 rounded-2xl bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 focus:border-pink-500 focus:ring-4 focus:ring-pink-500/10 outline-none text-xl font-medium transition-all"
                />
              </div>

              <button 
                type="submit"
                disabled={!newPiggyName || !newPiggyGoal}
                className="w-full bg-pink-500 text-white font-bold py-5 rounded-2xl shadow-xl shadow-pink-500/30 hover:bg-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform active:scale-[0.98] text-lg mt-4"
              >
                Criar Cofrinho
              </button>
            </form>
          </div>
        )}

        {/* Detail View */}
        {view === 'details' && selectedPiggy && (
          <div className="p-4 animate-fade-in relative min-h-screen pb-20">
            {showCoinAnim && <CoinAnimation onComplete={() => setShowCoinAnim(false)} />}
            
            <div className="flex items-center justify-between mb-6 sticky top-0 z-20">
              <button onClick={() => setView('dashboard')} className="p-3 bg-white/50 dark:bg-slate-800/50 backdrop-blur-md border border-slate-200 dark:border-slate-700 rounded-full active:scale-90 transition-transform">
                <ArrowLeft size={24} />
              </button>
              <button onClick={() => setShowBreakModal(true)} className="text-red-500 bg-red-50 dark:bg-red-900/10 px-4 py-2 rounded-full text-xs font-bold border border-red-100 dark:border-red-900/50 flex items-center gap-1.5 active:bg-red-100 transition-colors">
                <Hammer size={14} /> Quebrar
              </button>
            </div>

            {/* Main Piggy Display */}
            <div className="text-center mb-8 relative">
              <div 
                className={`w-36 h-36 mx-auto ${selectedPiggy.color || 'bg-pink-500'} rounded-full flex items-center justify-center text-white shadow-2xl shadow-pink-500/20 mb-5 transition-transform duration-300 ${showCoinAnim ? 'scale-110' : ''}`}
              >
                <PiggyBank size={72} strokeWidth={1.5} />
              </div>
              <h2 className="text-2xl font-bold leading-tight px-4">{selectedPiggy.name}</h2>
              <p className="text-slate-500 font-medium mt-1">Meta: {formatCurrency(selectedPiggy.goal)}</p>
              
              <div className="mt-5 bg-slate-50 dark:bg-slate-800 inline-block px-6 py-3 rounded-2xl border border-slate-100 dark:border-slate-700/50">
                <span className="text-4xl font-black tracking-tighter text-slate-800 dark:text-white block">
                  {formatCurrency(selectedPiggy.current)}
                </span>
                <span className="text-xs text-slate-400 font-bold uppercase tracking-wider">Saldo Atual</span>
              </div>
            </div>

            {/* Add Money Grid */}
            <h3 className="font-bold text-sm text-slate-400 uppercase tracking-wider mb-3 px-1">Adicionar Dinheiro</h3>
            <div className="grid grid-cols-3 gap-3 mb-4">
              {[1, 2, 5, 10, 20, 50].map(val => (
                <button 
                  key={val}
                  onClick={() => addMoney(val)}
                  className="bg-white dark:bg-slate-800 border-b-4 border-slate-200 dark:border-slate-700 active:border-b-0 active:translate-y-1 py-4 rounded-2xl font-bold text-slate-600 dark:text-slate-300 active:bg-pink-50 dark:active:bg-pink-900/20 shadow-sm transition-all text-lg touch-manipulation"
                >
                  R${val}
                </button>
              ))}
            </div>

            {/* Custom Amount */}
            <form 
              onSubmit={(e) => { e.preventDefault(); if(depositAmount) { addMoney(depositAmount); setDepositAmount(''); } }}
              className="flex gap-3 mb-8"
            >
              <div className="relative flex-1">
                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">R$</span>
                <input 
                  type="number" 
                  inputMode="decimal"
                  pattern="[0-9]*"
                  placeholder="Outro valor..." 
                  value={depositAmount}
                  onChange={e => setDepositAmount(e.target.value)}
                  className="w-full pl-10 pr-4 py-4 rounded-2xl bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 focus:border-pink-500 outline-none text-lg font-medium"
                />
              </div>
              <button 
                type="submit"
                disabled={!depositAmount}
                className="bg-slate-800 dark:bg-white text-white dark:text-slate-900 w-16 rounded-2xl font-bold hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center active:scale-95"
              >
                <Plus size={24} />
              </button>
            </form>

            {/* History */}
            <div className="bg-slate-100/50 dark:bg-slate-800/30 rounded-3xl p-5 border border-slate-200/50 dark:border-slate-700/50">
              <h3 className="font-bold text-sm text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                <History size={16} /> √öltimos Movimentos
              </h3>
              <div className="space-y-4 max-h-60 overflow-y-auto custom-scrollbar pr-2">
                {selectedPiggy.history && selectedPiggy.history.length > 0 ? (
                  selectedPiggy.history.map((item, idx) => (
                    <div key={idx} className="flex justify-between items-center text-sm">
                      <div className="flex items-center gap-3">
                         <div className={`w-8 h-8 flex items-center justify-center rounded-full ${item.type === 'deposit' ? 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400' : 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400'}`}>
                           {item.type === 'deposit' ? <TrendingUp size={14} /> : <Trash2 size={14} />}
                         </div>
                         <div className="flex flex-col">
                           <span className="font-medium text-slate-700 dark:text-slate-300">
                             {item.type === 'deposit' ? 'Dep√≥sito' : 'Quebra de cofrinho'}
                           </span>
                           <span className="text-xs text-slate-400">
                             {new Date(item.date).toLocaleDateString('pt-BR')}
                           </span>
                         </div>
                      </div>
                      <span className={`font-bold text-base ${item.type === 'deposit' ? 'text-green-500' : 'text-red-500'}`}>
                        {item.type === 'deposit' ? '+' : ''}{formatCurrency(item.amount)}
                      </span>
                    </div>
                  ))
                ) : (
                  <div className="text-center py-6">
                    <p className="text-slate-400 text-sm">Nenhuma atividade recente.</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

      </main>

      {/* Break Piggy Modal - Mobile Optimized */}
      {showBreakModal && (
        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
          <div className="bg-white dark:bg-slate-900 w-full sm:max-w-sm sm:rounded-3xl rounded-t-3xl p-6 shadow-2xl transform transition-all slide-up-mobile">
            <div className="w-12 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full mx-auto mb-6 sm:hidden" />
            
            <div className="bg-red-100 dark:bg-red-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500">
              <Hammer size={32} />
            </div>
            <h3 className="text-xl font-bold text-center mb-2">Quebrar o Cofrinho?</h3>
            <p className="text-center text-slate-500 dark:text-slate-400 mb-8 leading-relaxed px-4">
              Voc√™ vai retirar <strong className="text-slate-800 dark:text-white">{formatCurrency(selectedPiggy?.current)}</strong>. <br/>O valor voltar√° para zero.
            </p>
            <div className="grid grid-cols-2 gap-3 mb-2">
              <button 
                onClick={() => setShowBreakModal(false)}
                className="py-4 rounded-2xl font-bold border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors active:scale-95 text-slate-600 dark:text-slate-300"
              >
                Cancelar
              </button>
              <button 
                onClick={breakPiggy}
                className="bg-red-500 text-white py-4 rounded-2xl font-bold hover:bg-red-600 transition-colors shadow-lg shadow-red-500/30 active:scale-95"
              >
                QUEBRAR!
              </button>
            </div>
            <div className="mt-6 text-center pb-2">
              <button onClick={() => { deletePiggy(); setShowBreakModal(false); }} className="text-xs text-red-400 font-medium hover:text-red-500 flex items-center justify-center gap-1 mx-auto py-2">
                <Trash2 size={12} /> Excluir este cofrinho permanentemente
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Styles for Animations & Mobile */}
      <style>{`
        @keyframes drop-coin {
          0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
          20% { opacity: 1; }
          80% { opacity: 1; }
          100% { transform: translateY(20vh) rotate(720deg); opacity: 0; }
        }
        .animate-drop-coin {
          animation: drop-coin 0.8s ease-in forwards;
        }
        @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fade-in 0.3s ease-out forwards;
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
          animation: fade-in-up 0.4s ease-out forwards;
        }
        
        /* Mobile Slide Up Animation */
        @keyframes slide-up {
          from { transform: translateY(100%); }
          to { transform: translateY(0); }
        }
        .slide-up-mobile {
          animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .custom-scrollbar::-webkit-scrollbar {
          width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: #cbd5e1;
          border-radius: 20px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: #475569;
        }
        
        /* Prevent elastic scroll on body for app-feel */
        body {
          overscroll-behavior-y: none;
        }
        
        /* Safe Area Spacing */
        .safe-top {
          padding-top: env(safe-area-inset-top, 16px);
        }
      `}</style>
    </div>
  );
}
